/*! check v0.1.0 | (c) 2014  */
!function(a){"use strict";var b,c,d,e,f,g;b=a.easyPlug({name:"check",events:["invalid","valid","success","fail"],regional:{},presets:{htmlValidation:!1,validateOnSubmit:!0,validateOnChange:!0},construct:function(){this.settings.regional=a.extend({},b.regional[""],this.settings.regional),this.settings.htmlValidation=this.settings.htmlValidation||!e,this.refresh(),this.enable()},prototype:{enabled:!1,enable:function(){var a=this;this.enabled||(this.settings.htmlValidation||this.fields.on(b.addNamespace("invalid"),function(b){b.preventDefault(),clearTimeout(f),f=setTimeout(function(){a.validate()},1)}),this.settings.validateOnChange&&this.fields.on(b.addNamespace("blur change keyup keydown"),function(){a.validateField(this)}),this.settings.validateOnSubmit&&this.element.on(b.addNamespace("submit"),function(b){a.validate()||b.preventDefault()}),this.enabled=!0)},disable:function(){this.enabled&&(this.fields.off(b.addNamespace("blur change keyup keydown invalid")).removeData(b.addPrefix("options")),this.element.off(b.addNamespace("submit")),this.enabled=!1)},refresh:function(){var b=this.enabled;this.disable(),this.fields=a(this.element.find(':input:not([type="button"],[type="submit"],[type="reset"])')).removeData(d),b&&this.enable()},validate:function(){var a=!0,c=this;return this.fields.each(function(){a=c.validateField(this)&&a}),this.element.trigger(b.events[a?"success":"fail"]),a},validateField:function(d,e){return d=a(d),e=c.getInstance(e),this.validateValue(b.getFieldValue(d),b.getFieldOptions(d),e),d.trigger(b.events[e.isValid()?"valid":"invalid"],[e]),e.isValid()},validateValue:function(a,d,e){return e=c.getInstance(e),""===a?d.required&&e.setRule("required",!1,this.getMessage("required",d)):b.validators[d.type]&&b.validators[d.type].call(this,a,d,e),e.isValid()},getMessage:function(c,d){return this.settings.regional[c]?b.parseMessage(this.settings.regional[c],a.extend({},this.settings.regional.placeholders,d)):c}}}),b.regional={"":{required:"{{field}} is required.",urlFormat:"{{field}} must be a valid URL",placeholders:{field:"this field"}}},b.validators={},e=document.createElement("input").hasOwnProperty("oninvalid"),d=b.addPrefix("options"),b.getFieldOptions=function(b){var c;return b=a(b),c=b.data(d),c||(c={type:b.prop("type")||"text",required:b.prop("required"),step:parseFloat(b.prop("step")),min:parseFloat(b.prop("min")),max:parseFloat(b.prop("max")),maxlength:parseFloat(b.prop("maxlength"))},c=a.extend(c,new Function("return {"+(b.attr("data-rules")||"")+"}")()),b.data(d,c)),c},b.getFieldValue=function(b){var c,d;return b=a(b),c=b.val(),""===c&&e&&(d=b.prop("validity"),c=d.valueMissing||d.valid?"":!1),c},b.parseMessage=function(a,b){return g[a]=g[a]||new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("{{").join("	").replace(/((^|\}\})[^\t]*)'/g,"$1\r").replace(/\t(.*?)\}\}/g,"',$1,'").split("	").join("');").split("}}").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"),g[a](b)},g={},c=function(a){("object"!=typeof a||a instanceof Array)&&(a={}),this.data=a,a.rules=[],a.messages={},a.errors=[]},c.getInstance=function(a){return a instanceof c||(a=new c(a)),a},c.prototype={setRule:function(a,b,c){return this.data.rules.push(a),this.data.messages[a]=c,b||this.data.errors.push(a),this},isValid:function(){return!this.data.errors.length},isValidRule:function(b){return-1===a.inArray(b,this.data.errors)},getErrors:function(){return this.data.errors},getRule:function(a){return this.data.rules[a]},getRules:function(){return this.data.rules},getMessage:function(a){return this.data.messages[a]}}}(jQuery);